# Recommendations for GoBeyondFit Agent Context Files

**Generated by:** Gemini Pro Agent
**Date:** 2025-12-12
**Objective:** Provide recommendations to improve the context files (`.md`) for each of the 15 specialized agents. These recommendations are intended to be used by Claude Sonnet 4.5 to create more effective and contextually-aware agent definitions.

---

## ðŸ“ˆ Overall Recommendations

These suggestions apply broadly to all agent files and aim to improve consistency, clarity, and alignment with the project's specific context.

1.  **Standardize on "GoBeyondFit" Specific Examples:** Many examples are generic. They should be rewritten to directly reference the project's domain models like `Program`, `Workout`, `Exercise`, and `Session`. Instead of "Entity" or "NewEntity", use actual model names from `prisma/schema.prisma`.

2.  **Integrate `zod` for Validation:** The project uses `class-validator`. However, the frontend stack mentions `zod`. For consistency and better type safety between frontend and backend, the project should standardize on one. `zod` is a more modern and powerful choice. The `security-agent`, `api-agent`, and `architecture-agent` should be updated to reflect this, with examples using `Zod` schemas for DTOs and validation.

3.  **Emphasize Asynchronous Operations:** All database interactions with Prisma are asynchronous. The examples in agent files should consistently use `async/await` and return `Promise<T>` where appropriate. This is often missing in quick examples.

4.  **Refine Quick Commands:** The "Quick Commands" are a great idea but can be more precise. They should be structured as complete, copy-pasteable prompts that include the agent's file path for context.
    *   **Bad:** `Tu es le Security Agent. Audite le fichier...`
    *   **Good:** `@workspace #file:.copilot/agents/01-security-agent.md\nReview the following file for security vulnerabilities, focusing on IDOR and missing auth guards:\n#file:backend/src/path/to/file.ts`

5.  **Strengthen Inter-Agent Awareness:** The agent definitions are very siloed. They should include hints about when to consult other agents. For example, the `database-agent` should suggest consulting the `performance-agent` when adding indexes. The `session-manager-agent` is a good start but this can be integrated more deeply.

---

## ðŸ¤– Agent-Specific Recommendations

### 01-security-agent.md
- **Good:** Excellent coverage of OWASP, IDOR, and SQL Injection with Prisma-specific examples.
- **Improvement:** Explicitly mention `zod` for input validation in DTOs as a primary defense, replacing or augmenting `class-validator`. The `DTO Validation` pattern should show a `zod` schema example.
- **Improvement:** Add a section on protecting against brute-force attacks on the login endpoint, mentioning the use of `@nestjs/throttler` as a concrete implementation.

### 02-testing-agent.md
- **Good:** Clear distinction between unit, integration, and E2E tests with solid templates.
- **Improvement:** The E2E test template should show how to clean up the database *after* the test run, specifically for the test data it creates (e.g., the `e2e@test.com` user). This is critical for test isolation.
- **Improvement:** The integration test template mocks the service layer. Add an alternative example that hits an in-memory or test database to provide more realistic integration testing patterns for the team. Mention tools like `testcontainers`.

### 03-architecture-agent.md
- **Good:** Very detailed and accurate representation of the existing NestJS and Next.js architecture. The step-by-step feature implementation workflow is excellent.
- **Improvement:** The Prisma schema is well-defined, but could be improved by explicitly defining `onDelete` referential actions (e.g., `onDelete: Cascade` or `onDelete: SetNull`) for relations to make data integrity rules clearer.
- **Improvement:** The frontend architecture section should explicitly mention `TanStack Query` for server state management and caching, as it's a core part of the stack. Show an example of a custom hook (e.g., `usePrograms`) that uses `useQuery`.

### 04-performance-agent.md
- **Good:** Fantastic, practical examples of N+1 anti-patterns and pagination. The Prisma query logging is a great tip.
- **Improvement:** The "Smart Prisma Queries" section should include an example of using `select` within an `include` to avoid fetching unnecessary fields from related models, which is a common performance pitfall.
- **Improvement:** Add a small section on frontend performance regarding server-side rendering (SSR) vs. client-side rendering (CSR) in Next.js, and when to use `getServerSideProps` vs. `useEffect` with TanStack Query for data fetching.

### 05-api-agent.md
- **Good:** Strong, RESTful principles are well-documented. The pagination and error response formats are clear.
- **Improvement:** The "Field Selection" example is good but can be improved. It should show how to parse the `fields` query parameter and pass a `select` object to Prisma. The current example is pseudo-code.
- **Improvement:** Add a section on **API Versioning** (e.g., `/api/v1/...`). While not needed for the MVP, the agent should state that this is a best practice to consider for the future to avoid breaking changes.

### 06-database-agent.md
- **Good:** Clear rules for migrations, indexing, and multi-tenancy. The soft-delete logic is well-explained.
- **Improvement:** The section on "Missing Cascade Deletes" correctly identifies the problem but the solution is service-layer logic. The agent should also mention Prisma's relation features (`onDelete`) and explain *why* a service-layer transaction is preferred for soft-deletes (to correctly update `deletedAt` on related models).
- **Improvement:** When discussing adding a "tags" field, the agent should specify that `String[]` is the correct Prisma type for a PostgreSQL `text[]` array, and mention that this is a PostgreSQL-specific feature.

### 07-session-manager-agent.md
- **Good:** Provides an excellent, high-level orchestration role. The report template is structured and useful.
- **Improvement:** The "Agent Coordination Logic" is pseudo-code. It should be framed as a set of rules or a decision-making guide. For example: "If a `.service.ts` file is modified, *always* invoke the `security-agent` and `testing-agent`."
- **Improvement:** Add a command for "Pre-PR check" that runs a more comprehensive suite of agents (Security, Testing, Performance, Code Review) and generates a checklist for the Pull Request description.

### 08-documentation-agent.md
- **Good:** Strong emphasis on English-only documentation and clear JSDoc/TSDoc examples.
- **Improvement:** The Mermaid.js ERD is a great idea. It should be made more accurate to match the Prisma schema (e.g., show the `WorkoutExercise` join table explicitly).
- **Improvement:** The agent should have a "quick command" to generate a `README.md` for a new module, including its purpose, endpoints, and how to use it.

### 09-code-review-agent.md
- **Good:** Excellent, pragmatic checklist that balances strictness and practicality.
- **Improvement:** The "Missing Multi-Tenancy" example should show the controller passing the `userId` from the `@CurrentUser()` decorator to the service. This reinforces the full data flow.
- **Improvement:** The agent should suggest using a linter like ESLint with specific plugins (e.g., `eslint-plugin-security`) and a code formatter like Prettier as a first line of defense, which can be run automatically.

### 10-devops-cicd-agent.md
- **Good:** Clear, practical advice for the current local setup and future production options. The CI/CD YAML template is a great starting point.
- **Improvement:** The `docker-compose.yml` example should be updated to show how to mount the `prisma/` directory as a volume, so that `prisma generate` inside the container reflects changes on the host.
- **Improvement:** The GitHub Actions workflow should have a step for `pnpm lint` and `pnpm build` for both backend and frontend to catch errors before running tests.

### 11-frontend-ux-ui-agent.md
- **Good:** Excellent persona definition and UX goals. The focus on `shadcn/ui` and Linear-inspired design is very specific and helpful.
- **Improvement:** Add a section on **State Management Strategy**, explaining the roles of `TanStack Query` (for server state, caching, and optimistic updates) and `Zustand` (for global UI state like "is sidebar open"). Provide a clear example for each.
- **Improvement:** The "Create Program" user flow is great. It should be augmented with a mention of **Optimistic UI**. For example: "When the user adds an exercise, it should appear in the UI instantly while the API request is sent in the background." This is a key capability of TanStack Query.

### 12-innovation-agent.md
- **Good:** Fantastic, creative ideas that are well-grounded in free/low-cost services. The cost-benefit analysis is very useful.
- **Improvement:** The agent should be more explicit about how to integrate these features without adding significant maintenance overhead. For example, for the "Exercise Library with GIFs," it should suggest creating a separate, simple microservice or serverless function to handle the API key and caching, keeping the main backend clean.
- **Improvement:** For AI features, the agent should provide a more robust example prompt for the `tech-scout-agent` to evaluate, including negative constraints (e.g., "Do not suggest exercises that require a Smith machine").

### 13-tech-scout-agent.md
- **Good:** Excellent framework for evaluating new tech and a clear POC plan.
- **Improvement:** The evaluation criteria should include a "Team Skillset Fit" metric. Adopting a technology that no one on the team knows can be a significant risk, even if the tech is good.
- **Improvement:** The "Dependency Health Check" section should include a command to run `pnpm outdated --long` to see the latest available versions, which is more informative than the default output.

### 14-fitness-domain-agent.md
- **Good:** Superb, evidence-based fitness knowledge. The MRV/MAV/MEV table is gold for this project.
- **Improvement:** The agent's knowledge should be translated into more actionable validation rules. For example: "When a coach designs a program, flag any week where the volume for a muscle group exceeds its MRV." or "If a program has no deload week after 6 consecutive weeks of high intensity, suggest adding one."
- **Improvement:** The `calculate1RM` function is great. It should be presented within the context of a Prisma model. For example, suggest adding a `calculated1RM` field to the `Session` model's `data` JSON blob.

### 15-migration-agent.md
- **Good:** The "Expand-Contract" pattern is explained perfectly. This is a critical and often misunderstood concept.
- **Improvement:** The "Data Migration Script Template" is excellent. It should also include a small section on how to make the script idempotent (i.e., safe to run multiple times). This can be achieved by the `where` clause that already filters for records that haven't been migrated. This property should be explicitly stated.
- **Improvement:** The agent should strongly recommend using `CREATE INDEX CONCURRENTLY` in PostgreSQL for adding indexes in production to avoid locking the table. This is a crucial detail for zero-downtime migrations.

---
**Conclusion:** The agent definitions are very strong, detailed, and well-structured. The above recommendations are intended to be enhancements, not criticisms. By incorporating more project-specific examples, standardizing on the modern parts of the tech stack (`zod`, `TanStack Query`), and strengthening the connections between agents, these context files can become even more powerful tools for development.
